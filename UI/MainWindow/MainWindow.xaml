<Window x:Class="ExplorerPro.UI.MainWindow.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ExplorerPro.UI.MainWindow"
        xmlns:toolbar="clr-namespace:ExplorerPro.UI.Toolbar"
        xmlns:tabManagement="clr-namespace:ExplorerPro.UI.PaneManagement"
        xmlns:controls="clr-namespace:ExplorerPro.UI.Controls"
        mc:Ignorable="d"
        Title="Enhanced File Explorer"
        Height="800" 
        Width="1200"
        MinHeight="480" 
        MinWidth="640"
        Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}">

    <Window.Resources>
        <!-- 
        =============================================================================
        VALUE CONVERTERS
        =============================================================================
        Converters for binding UI element properties to data values
        -->
        
        <!-- Converts numeric count to Visibility (useful for hiding elements when count is 0) -->
        <local:CountToVisibilityConverter x:Key="CountToVisibilityConverter"/>
        
        <!-- Converts numeric count to boolean enabled state (useful for disabling buttons when count is 0) -->
        <local:CountToEnableConverter x:Key="CountToEnableConverter"/>
        
        <!-- 
        =============================================================================
        MODERN TAB STYLING RESOURCES
        =============================================================================
        Gradient brushes and visual effects for Chrome-style tab appearance
        -->
        
        <!-- Active tab gradient: Clean white to light gray for selected tabs -->
        <LinearGradientBrush x:Key="TabActiveGradient" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#FFFFFF" Offset="0"/>
            <GradientStop Color="#F8F9FA" Offset="1"/>
        </LinearGradientBrush>
        
        <!-- Hover tab gradient: Subtle blue tint for mouse-over state -->
        <LinearGradientBrush x:Key="TabHoverGradient" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#F0F7FF" Offset="0"/>
            <GradientStop Color="#E3F2FD" Offset="1"/>
        </LinearGradientBrush>
        
        <!-- Inactive tab gradient: Neutral gray for unselected tabs -->
        <LinearGradientBrush x:Key="TabInactiveGradient" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#FAFAFA" Offset="0"/>
            <GradientStop Color="#F0F0F0" Offset="1"/>
        </LinearGradientBrush>

        <!-- 
        =============================================================================
        TAB ANIMATION STORYBOARDS
        =============================================================================
        Smooth animations for tab interactions and visual feedback
        -->
        
        <!-- Tab hover animation: Subtle scale effect on mouse enter -->
        <Storyboard x:Key="TabHoverStoryboard">
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" 
                           To="1.08" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <QuadraticEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
        
        <!-- Tab hover exit animation: Return to normal scale on mouse leave -->
        <Storyboard x:Key="TabHoverExitStoryboard">
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" 
                           To="1.0" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <QuadraticEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <!-- Modern Icon Resources -->
        <DrawingImage x:Key="WindowIcon">
            <DrawingImage.Drawing>
                <DrawingGroup ClipGeometry="M0,0 V16 H16 V0 H0 Z">
                    <GeometryDrawing Brush="#4A90E2" Geometry="F1 M16,16z M0,0z M2,2L14,2 14,14 2,14z M3,3L13,3 13,13 3,13z"/>
                    <GeometryDrawing Brush="#357ABD" Geometry="F1 M16,16z M0,0z M2,2L14,2 14,4 2,4z"/>
                </DrawingGroup>
            </DrawingImage.Drawing>
        </DrawingImage>
        
        <!-- Application-level styles and resources -->
        <Style x:Key="SeparatorStyle" TargetType="Separator">
            <Setter Property="Background" Value="#CCC" />
            <Setter Property="Width" Value="3" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="Padding" Value="0" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#0083DB" />
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Icons now defined in UI/Resources/IconResources.xaml -->
        
        <!-- Activity Bar Button Style -->
        <Style x:Key="ActivityBarButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Margin" Value="0,4,0,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="ButtonBorder"
                              Background="#FFFFFF"
                              BorderBrush="#D0D7DE"
                              BorderThickness="1.5"
                              CornerRadius="8"
                              Padding="0">
                            <Border.Effect>
                                <DropShadowEffect x:Name="ButtonShadow" 
                                                Color="#FF000000" 
                                                Direction="270" 
                                                ShadowDepth="2" 
                                                BlurRadius="4" 
                                                Opacity="0.1"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <ColorAnimation Storyboard.TargetName="ButtonBorder"
                                                          Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                          To="#F6F8FA" Duration="0:0:0.15"/>
                                            <ColorAnimation Storyboard.TargetName="ButtonBorder"
                                                          Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                          To="#0969DA" Duration="0:0:0.15"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <ColorAnimation Storyboard.TargetName="ButtonBorder"
                                                          Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                          To="#FFFFFF" Duration="0:0:0.15"/>
                                            <ColorAnimation Storyboard.TargetName="ButtonBorder"
                                                          Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                          To="#D0D7DE" Duration="0:0:0.15"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="ButtonBorder" Property="Background" Value="#F0F7FF"/>
                            </Trigger>
                            <Trigger Property="Tag" Value="Active">
                                <Setter TargetName="ButtonBorder" Property="Background" Value="#E3F2FD"/>
                                <Setter TargetName="ButtonBorder" Property="BorderBrush" Value="#0969DA"/>
                                <Setter TargetName="ButtonBorder" Property="BorderThickness" Value="2"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Window.CommandBindings>
        <!-- Standard application commands -->
        <CommandBinding Command="ApplicationCommands.New" Executed="NewCommand_Executed" />
        <CommandBinding Command="ApplicationCommands.Open" Executed="OpenCommand_Executed" />
        <CommandBinding Command="ApplicationCommands.Save" Executed="SaveCommand_Executed" />
        <CommandBinding Command="ApplicationCommands.Close" Executed="CloseCommand_Executed" />
        
        <!-- Navigation Commands -->
        <CommandBinding Command="NavigationCommands.BrowseBack" Executed="BrowseBackCommand_Executed" />
        <CommandBinding Command="NavigationCommands.BrowseForward" Executed="BrowseForwardCommand_Executed" />
        <CommandBinding Command="NavigationCommands.BrowseHome" Executed="BrowseHomeCommand_Executed" />
        <CommandBinding Command="NavigationCommands.Refresh" Executed="RefreshCommand_Executed" />
        
        <!-- Edit Commands -->
        <CommandBinding Command="ApplicationCommands.Copy" Executed="CopyCommand_Executed" />
        <CommandBinding Command="ApplicationCommands.Cut" Executed="CutCommand_Executed" />
        <CommandBinding Command="ApplicationCommands.Paste" Executed="PasteCommand_Executed" />
        <CommandBinding Command="ApplicationCommands.Delete" Executed="DeleteCommand_Executed" />
        <CommandBinding Command="ApplicationCommands.Properties" Executed="PropertiesCommand_Executed" />

        <!-- Custom Commands (will be defined in code-behind) -->
    </Window.CommandBindings>

    <DockPanel LastChildFill="True">
        <!-- Main Toolbar -->
        <toolbar:Toolbar x:Name="Toolbar" DockPanel.Dock="Top" />

        <!-- Ultra-Modern Status Bar -->
        <Border DockPanel.Dock="Bottom" 
                Height="32"
                Background="#F6F8FA"
                BorderBrush="#D0D7DE"
                BorderThickness="0,1,0,0"
                Padding="12,0">
            <Border.Effect>
                <DropShadowEffect Color="#FF000000" Direction="90" ShadowDepth="1" BlurRadius="3" Opacity="0.05"/>
            </Border.Effect>
            
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Status Section -->
                <StackPanel Grid.Column="0" 
                           Orientation="Horizontal" 
                           VerticalAlignment="Center">
                    <Border Background="#22C55E" 
                            CornerRadius="4" 
                            Padding="6,2"
                            Margin="0,0,8,0">
                        <TextBlock x:Name="StatusText" 
                                  Text="Ready" 
                                  FontSize="11"
                                  FontWeight="SemiBold"
                                  Foreground="White"/>
                    </Border>
                </StackPanel>
                
                <!-- Item Count Section -->
                <StackPanel Grid.Column="1" 
                           Orientation="Horizontal" 
                           VerticalAlignment="Center">
                    <!-- Modern separator -->
                    <Rectangle Width="1" Height="16" Fill="#E1E4E8" Margin="8,0"/>
                    
                    <TextBlock x:Name="ItemCountText" 
                              Text="0 items" 
                              FontSize="12"
                              FontWeight="Medium"
                              Foreground="#656D76"
                              VerticalAlignment="Center"
                              Margin="8,0,0,0"/>
                </StackPanel>
                
                <!-- Selection Section -->
                <StackPanel Grid.Column="3" 
                           Orientation="Horizontal" 
                           VerticalAlignment="Center">
                    <TextBlock x:Name="SelectionText" 
                              Text="" 
                              FontSize="12"
                              FontWeight="Medium"
                              Foreground="#0969DA"
                              VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- VS Code Style Activity Bar -->
        <Border DockPanel.Dock="Left" 
                Width="48"
                Background="#F6F8FA"
                BorderBrush="#D0D7DE"
                BorderThickness="0,0,1,0">
            <Border.Effect>
                <DropShadowEffect Color="#FF000000" Direction="0" ShadowDepth="1" BlurRadius="3" Opacity="0.05"/>
            </Border.Effect>
            <ScrollViewer VerticalScrollBarVisibility="Auto" 
                          HorizontalScrollBarVisibility="Disabled">
                <StackPanel x:Name="ActivityBar" 
                            Orientation="Vertical"
                            Margin="8,8,8,0">
                    
                    <!-- Toggle Pinned Panel -->
                    <Button x:Name="ActivityBarPinnedButton"
                            ToolTip="Toggle Pinned Panel (Ctrl+P)"
                            Click="TogglePinnedPanel_Click"
                            Style="{StaticResource ActivityBarButtonStyle}">
                        <Image Source="{StaticResource PinIcon}" 
                               Width="18" Height="18"
                               RenderOptions.BitmapScalingMode="HighQuality"/>
                    </Button>
                    
                    <!-- Toggle Bookmarks -->
                    <Button x:Name="ActivityBarBookmarksButton"
                            ToolTip="Toggle Bookmarks (Ctrl+B)"
                            Click="ToggleBookmarksPanel_Click"
                            Style="{StaticResource ActivityBarButtonStyle}">
                        <Image Source="{StaticResource StarIcon}" 
                               Width="18" Height="18"
                               RenderOptions.BitmapScalingMode="HighQuality"/>
                    </Button>
                    
                    <!-- Toggle Procore Links -->
                    <Button x:Name="ActivityBarProcoreButton"
                            ToolTip="Toggle Procore Links (Ctrl+K)"
                            Click="ToggleProcorePanel_Click"
                            Style="{StaticResource ActivityBarButtonStyle}">
                        <Image Source="{StaticResource LinkIcon}" 
                               Width="18" Height="18"
                               RenderOptions.BitmapScalingMode="HighQuality"/>
                    </Button>
                    
                    <!-- Toggle To-do -->
                    <Button x:Name="ActivityBarTodoButton"
                            ToolTip="Toggle To-do (Ctrl+D)"
                            Click="ToggleTodoPanel_Click"
                            Style="{StaticResource ActivityBarButtonStyle}">
                        <Image Source="{StaticResource TodoIcon}" 
                               Width="18" Height="18"
                               RenderOptions.BitmapScalingMode="HighQuality"/>
                    </Button>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Main Content Area -->
        <Grid>
            <!-- Chrome-Style Tab Control for WindowContainers -->
            <controls:ChromeStyleTabControl x:Name="MainTabs" 
                                          AllowAddNew="True"
                                          AllowDelete="True"
                                          TabStripPlacement="Top"
                                          BorderThickness="0"
                                          Padding="0"
                                          Background="Transparent"
                                          MaxTabCount="20"
                                          ShowAddTabButton="True">
                <TabControl.Resources>
                    <!-- Ultra-Modern Chrome-style TabItem - Override global style -->
                    <Style TargetType="{x:Type TabItem}" x:Key="MainWindowTabStyle">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="{x:Type TabItem}">
                                    <Border x:Name="TabBorder"
                                          Background="{StaticResource TabInactiveGradient}"
                                          BorderBrush="#D0D7DE"
                                          BorderThickness="1,1,1,0"
                                          CornerRadius="12,12,0,0"
                                          Margin="2,4,2,0"
                                          Padding="0"
                                          RenderTransformOrigin="0.5,0.5">
                                        <Border.Effect>
                                            <DropShadowEffect x:Name="TabShadow" 
                                                            Color="#FF000000" 
                                                            Direction="270" 
                                                            ShadowDepth="2" 
                                                            BlurRadius="6" 
                                                            Opacity="0.1"/>
                                        </Border.Effect>
                                        <Border.RenderTransform>
                                            <TransformGroup>
                                                <ScaleTransform/>
                                                <TranslateTransform/>
                                            </TransformGroup>
                                        </Border.RenderTransform>
                                        
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <!-- Window icon -->
                                            <Image x:Name="TabIcon"
                                                 Grid.Column="0" 
                                                 Width="16" Height="16"
                                                 Margin="8,0,6,0"
                                                 VerticalAlignment="Center"
                                                 Source="{StaticResource WindowIcon}"/>
                                            
                                            <!-- Tab title with better typography -->
                                            <TextBlock x:Name="TabTitle"
                                                     Grid.Column="1" 
                                                     Text="{Binding Header, RelativeSource={RelativeSource TemplatedParent}}" 
                                                     Margin="0,10,8,10"
                                                     VerticalAlignment="Center"
                                                     FontSize="13"
                                                     FontWeight="Medium"
                                                     Foreground="#24292F"
                                                     TextTrimming="CharacterEllipsis">
                                                <TextBlock.Effect>
                                                    <DropShadowEffect Color="White" BlurRadius="1" ShadowDepth="0.5" Opacity="0.8"/>
                                                </TextBlock.Effect>
                                            </TextBlock>
                                            
                                            <!-- Enhanced close button (hover-to-show) -->
                                            <Button x:Name="CloseButton"
                                                  Grid.Column="2" 
                                                  Content="✕" 
                                                  FontSize="12"
                                                  FontWeight="Bold"
                                                  Width="24" Height="24"
                                                  Margin="4,0,8,0"
                                                  BorderThickness="0"
                                                  Background="Transparent"
                                                  Foreground="#656D76"
                                                  VerticalAlignment="Center"
                                                  Click="TabCloseButton_Click"
                                                  ToolTip="Close Tab (Middle-click also closes)"
                                                  Opacity="0"
                                                  Style="{x:Null}">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border x:Name="CloseButtonBorder"
                                                              Background="Transparent"
                                                              CornerRadius="12"
                                                              Padding="4">
                                                            <ContentPresenter HorizontalAlignment="Center" 
                                                                            VerticalAlignment="Center"/>
                                                            <Border.Effect>
                                                                <DropShadowEffect x:Name="CloseButtonShadow" 
                                                                                Color="#FF000000" 
                                                                                BlurRadius="3" 
                                                                                ShadowDepth="1" 
                                                                                Opacity="0"/>
                                                            </Border.Effect>
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Trigger.EnterActions>
                                                                    <BeginStoryboard>
                                                                        <Storyboard>
                                                                            <ColorAnimation Storyboard.TargetName="CloseButtonBorder"
                                                                                          Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                                                          To="#E53E3E" Duration="0:0:0.15"/>
                                                                            <ColorAnimation Storyboard.TargetProperty="(TextBlock.Foreground).(SolidColorBrush.Color)"
                                                                                          To="White" Duration="0:0:0.15"/>
                                                                        </Storyboard>
                                                                    </BeginStoryboard>
                                                                </Trigger.EnterActions>
                                                                <Trigger.ExitActions>
                                                                    <BeginStoryboard>
                                                                        <Storyboard>
                                                                            <ColorAnimation Storyboard.TargetName="CloseButtonBorder"
                                                                                          Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                                                          To="Transparent" Duration="0:0:0.15"/>
                                                                            <ColorAnimation Storyboard.TargetProperty="(TextBlock.Foreground).(SolidColorBrush.Color)"
                                                                                          To="#656D76" Duration="0:0:0.15"/>
                                                                        </Storyboard>
                                                                    </BeginStoryboard>
                                                                </Trigger.ExitActions>
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>
                                        </Grid>
                                    </Border>
                                    
                                    <ControlTemplate.Triggers>
                                        <!-- Selected tab with enhanced styling -->
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="TabBorder" Property="Background" Value="{StaticResource TabActiveGradient}"/>
                                            <Setter TargetName="TabBorder" Property="BorderBrush" Value="#0969DA"/>
                                            <Setter TargetName="TabBorder" Property="BorderThickness" Value="1,3,1,0"/>
                                            <Setter TargetName="TabTitle" Property="Foreground" Value="#0969DA"/>
                                            <Setter TargetName="TabTitle" Property="FontWeight" Value="SemiBold"/>
                                            <Setter Property="Panel.ZIndex" Value="100"/>
                                        </Trigger>
                                        
                                        <!-- Enhanced hover effect with close button -->
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="TabBorder" Property="Background" Value="{StaticResource TabHoverGradient}"/>
                                            <Trigger.EnterActions>
                                                <BeginStoryboard Storyboard="{StaticResource TabHoverStoryboard}"/>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <!-- Show close button on hover -->
                                                        <DoubleAnimation Storyboard.TargetName="CloseButton"
                                                                       Storyboard.TargetProperty="Opacity"
                                                                       To="1" Duration="0:0:0.2"
                                                                       BeginTime="0:0:0.1"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                            <Trigger.ExitActions>
                                                <BeginStoryboard Storyboard="{StaticResource TabHoverExitStoryboard}"/>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <!-- Hide close button when not hovering -->
                                                        <DoubleAnimation Storyboard.TargetName="CloseButton"
                                                                       Storyboard.TargetProperty="Opacity"
                                                                       To="0" Duration="0:0:0.15"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.ExitActions>
                                        </Trigger>
                                        
                                        <!-- Always show close button when selected -->
                                        <MultiTrigger>
                                            <MultiTrigger.Conditions>
                                                <Condition Property="IsSelected" Value="True"/>
                                            </MultiTrigger.Conditions>
                                            <Setter TargetName="CloseButton" Property="Opacity" Value="0.7"/>
                                        </MultiTrigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="Margin" Value="0"/>
                        <Setter Property="MinWidth" Value="140"/>
                        <Setter Property="MaxWidth" Value="280"/>
                        <Setter Property="Height" Value="38"/>
                        <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
                        <Setter Property="RenderTransform">
                            <Setter.Value>
                                <TransformGroup>
                                    <ScaleTransform/>
                                    <TranslateTransform/>
                                </TransformGroup>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </TabControl.Resources>

                <!-- Apply the modern TabItem style -->
                <TabControl.ItemContainerStyle>
                    <Style TargetType="{x:Type TabItem}" BasedOn="{StaticResource MainWindowTabStyle}" />
                </TabControl.ItemContainerStyle>

                <!-- Ultra-Modern TabControl Template matching File Tree tabs -->
                <TabControl.Template>
                    <ControlTemplate TargetType="{x:Type TabControl}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <!-- Ultra-Modern Enhanced tab header with glass effect -->
                            <Border Grid.Row="0" 
                                  Background="#F6F8FA"
                                  BorderBrush="#D0D7DE"
                                  BorderThickness="0,0,0,1">
                                <Border.Effect>
                                    <DropShadowEffect Color="#FF000000" Direction="270" ShadowDepth="1" BlurRadius="3" Opacity="0.08"/>
                                </Border.Effect>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Tab headers with professional styling -->
                                    <TabPanel x:Name="HeaderPanel" 
                                             Grid.Column="0" 
                                             IsItemsHost="True"
                                             Background="Transparent"
                                             Panel.ZIndex="1"
                                             KeyboardNavigation.TabIndex="1"
                                             Margin="8,0,0,0"/>
                                    
                                    <!-- Ultra-modern button panel -->
                                    <StackPanel Grid.Column="1" 
                                               Orientation="Horizontal" 
                                               VerticalAlignment="Center" 
                                               Margin="8,6">
                                        
                                        <!-- Ultra-modern add tab button -->
                                        <Button x:Name="AddTabButton" 
                                               Content="＋"
                                               Width="32" 
                                               Height="32"
                                               Margin="0,0,4,0"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Center"
                                               FontSize="16"
                                               FontWeight="Normal"
                                               Click="AddTabButton_Click"
                                               ToolTip="Add new window tab"
                                               Style="{x:Null}">
                                            <Button.Template>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="ButtonBorder"
                                                          Background="#FFFFFF"
                                                          BorderBrush="#D0D7DE"
                                                          BorderThickness="1.5"
                                                          CornerRadius="8"
                                                          Padding="0">
                                                        <Border.Effect>
                                                            <DropShadowEffect x:Name="ButtonShadow" 
                                                                            Color="#FF000000" 
                                                                            Direction="270" 
                                                                            ShadowDepth="2" 
                                                                            BlurRadius="4" 
                                                                            Opacity="0.1"/>
                                                        </Border.Effect>
                                                        <ContentPresenter HorizontalAlignment="Center" 
                                                                        VerticalAlignment="Center"
                                                                        TextElement.Foreground="#24292F"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Trigger.EnterActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <ColorAnimation Storyboard.TargetName="ButtonBorder"
                                                                                      Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                                                      To="#F6F8FA" Duration="0:0:0.15"/>
                                                                        <ColorAnimation Storyboard.TargetName="ButtonBorder"
                                                                                      Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                                                      To="#0969DA" Duration="0:0:0.15"/>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </Trigger.EnterActions>
                                                            <Trigger.ExitActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <ColorAnimation Storyboard.TargetName="ButtonBorder"
                                                                                      Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                                                      To="#FFFFFF" Duration="0:0:0.15"/>
                                                                        <ColorAnimation Storyboard.TargetName="ButtonBorder"
                                                                                      Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                                                      To="#D0D7DE" Duration="0:0:0.15"/>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </Trigger.ExitActions>
                                                        </Trigger>
                                                        <Trigger Property="IsPressed" Value="True">
                                                            <Setter TargetName="ButtonBorder" Property="Background" Value="#F0F7FF"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Button.Template>
                                        </Button>

                                        <!-- Panel toggle buttons now in Activity Bar -->
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- Enhanced content area -->
                            <Border Grid.Row="1" 
                                   Background="{TemplateBinding Background}"
                                   Padding="0"
                                   Margin="0">
                                <ContentPresenter x:Name="PART_SelectedContentHost" 
                                                ContentSource="SelectedContent"
                                                Margin="0"/>
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </TabControl.Template>

                <!-- Context Menu for TabControl -->
                <TabControl.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="New Tab" Click="NewTabMenuItem_Click" />
                        <MenuItem Header="Duplicate Tab" Click="DuplicateTabMenuItem_Click" />
                        <MenuItem Header="Close Tab" Click="CloseTabMenuItem_Click" 
                                 IsEnabled="{Binding RelativeSource={RelativeSource AncestorType=TabControl}, Path=Items.Count, Converter={StaticResource CountToEnableConverter}}" />
                        <Separator />
                        <MenuItem Header="Toggle Split View" Click="ToggleSplitViewMenuItem_Click" />
                        <MenuItem Header="Detach Tab" Click="DetachTabMenuItem_Click" 
                                 IsEnabled="{Binding RelativeSource={RelativeSource AncestorType=TabControl}, Path=Items.Count, Converter={StaticResource CountToEnableConverter}}" />
                        <MenuItem Header="Move to New Window" Click="MoveToNewWindowMenuItem_Click" 
                                 IsEnabled="{Binding RelativeSource={RelativeSource AncestorType=TabControl}, Path=Items.Count, Converter={StaticResource CountToEnableConverter}}" />
                    </ContextMenu>
                </TabControl.ContextMenu>
            </controls:ChromeStyleTabControl>
        </Grid>
    </DockPanel>
</Window>