<UserControl x:Class="ExplorerPro.UI.MainWindow.MainWindowTabs"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:ExplorerPro.UI.MainWindow"
             xmlns:converters="clr-namespace:ExplorerPro.UI.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    
    <UserControl.Resources>
        <!-- Value converters for hiding close button on single tab -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        
        <!-- Converter that returns Visibility.Collapsed when count is 1, Visible otherwise -->
        <converters:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />
        
        <!-- Converter that returns false when count is 1, true otherwise -->
        <converters:CountToEnableConverter x:Key="CountToEnableConverter" />

        <!-- Modern Gradients and Brushes -->
        <LinearGradientBrush x:Key="TabActiveGradient" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#FFFFFF" Offset="0"/>
            <GradientStop Color="#F8F9FA" Offset="1"/>
        </LinearGradientBrush>
        
        <LinearGradientBrush x:Key="TabHoverGradient" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#F0F7FF" Offset="0"/>
            <GradientStop Color="#E3F2FD" Offset="1"/>
        </LinearGradientBrush>
        
        <LinearGradientBrush x:Key="TabInactiveGradient" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#FAFAFA" Offset="0"/>
            <GradientStop Color="#F0F0F0" Offset="1"/>
        </LinearGradientBrush>

        <!-- Enhanced Animation Storyboards -->
        <Storyboard x:Key="TabHoverStoryboard">
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" 
                           To="1.08" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <QuadraticEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <!-- DropShadowEffect animations removed to prevent dependency object errors -->
        </Storyboard>
        
        <Storyboard x:Key="TabHoverExitStoryboard">
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" 
                           To="1.0" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <QuadraticEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <!-- DropShadowEffect animations removed to prevent dependency object errors -->
        </Storyboard>

        <Storyboard x:Key="TabFadeInStoryboard">
            <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                           From="0" To="1" Duration="0:0:0.4">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)" 
                           From="40" To="0" Duration="0:0:0.4">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <Storyboard x:Key="TabHibernateFadeStoryboard">
            <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                           To="0.5" Duration="0:0:0.5">
                <DoubleAnimation.EasingFunction>
                    <QuadraticEase EasingMode="EaseInOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <Storyboard x:Key="TabRestoreStoryboard">
            <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                           To="1.0" Duration="0:0:0.4">
                <DoubleAnimation.EasingFunction>
                    <QuadraticEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <!-- Modern Icon Resources -->
        <DrawingImage x:Key="FolderIcon">
            <DrawingImage.Drawing>
                <DrawingGroup ClipGeometry="M0,0 V16 H16 V0 H0 Z">
                    <GeometryDrawing Brush="#FFD700" Geometry="F1 M16,16z M0,0z M2,2L14,2 14,4 2,4z M1,5L15,5 15,14 1,14z"/>
                    <GeometryDrawing Brush="#FFA500" Geometry="F1 M16,16z M0,0z M2,2L14,2 14,3 2,3z"/>
                </DrawingGroup>
            </DrawingImage.Drawing>
        </DrawingImage>

        <DrawingImage x:Key="FileIcon">
            <DrawingImage.Drawing>
                <DrawingGroup ClipGeometry="M0,0 V16 H16 V0 H0 Z">
                    <GeometryDrawing Brush="#4A90E2" Geometry="F1 M16,16z M0,0z M3,1L10,1 13,4 13,15 3,15z M10,1L10,4 13,4"/>
                    <GeometryDrawing Brush="#357ABD" Geometry="F1 M16,16z M0,0z M10,1L10,4 13,4z"/>
                </DrawingGroup>
            </DrawingImage.Drawing>
        </DrawingImage>
    </UserControl.Resources>
    
    <Grid>
        <TabControl x:Name="TabControl" 
                  Background="Transparent"
                  BorderThickness="0"
                  Padding="0"
                  Template="{StaticResource ModernTabControlTemplate}"
                  ItemContainerStyle="{StaticResource ModernTabItemStyle}"
                  AllowDrop="True"
                  SelectionChanged="TabControl_SelectionChanged"
                  Loaded="TabControl_Loaded">
            
            <!-- Context Menu for TabControl -->
            <TabControl.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="New Tab" Click="NewTabMenuItem_Click" />
                    <MenuItem Header="Duplicate Tab" Click="DuplicateTabMenuItem_Click" />
                    <MenuItem Header="Close Tab" Click="CloseTabMenuItem_Click" 
                             IsEnabled="{Binding RelativeSource={RelativeSource AncestorType=TabControl}, 
                                        Path=Items.Count, Converter={StaticResource CountToEnableConverter}}" />
                    <Separator />
                    <MenuItem Header="Hibernate Tab" Click="HibernateTabMenuItem_Click" 
                             IsEnabled="{Binding RelativeSource={RelativeSource AncestorType=TabControl}, 
                                        Path=Items.Count, Converter={StaticResource CountToEnableConverter}}" />
                    <MenuItem Header="Restore Tab" Click="RestoreTabMenuItem_Click" />
                    <Separator />
                    <MenuItem Header="Toggle Split View" Click="ToggleSplitViewMenuItem_Click" />
                    <MenuItem Header="Detach Tab" Click="DetachTabMenuItem_Click" 
                             IsEnabled="{Binding RelativeSource={RelativeSource AncestorType=TabControl}, 
                                        Path=Items.Count, Converter={StaticResource CountToEnableConverter}}" />
                    <MenuItem Header="Move to New Window" Click="MoveToNewWindowMenuItem_Click" 
                             IsEnabled="{Binding RelativeSource={RelativeSource AncestorType=TabControl}, 
                                        Path=Items.Count, Converter={StaticResource CountToEnableConverter}}" />
                </ContextMenu>
            </TabControl.ContextMenu>
        </TabControl>
    </Grid>
</UserControl>